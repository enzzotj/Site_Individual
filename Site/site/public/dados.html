<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPlayers | Dados</title>
    <link rel="stylesheet" href="./css/componentes.css">
    <link rel="stylesheet" href="./css/dados.css">
</head>

<body onload="atualizarVoto()">
    <header>
        <div class="container_header">
            <div class="container">
                <div class="container_img_logo">
                    <img style="cursor:default;" src="./assets/icon/logoHome.png" alt="Logo">
                </div>
            <img class="img_sair" src="./assets/img/logof.png" onclick="window.location.href='./index.html'"></img>
        </div>
    </header>

    <main>
        <div class="container_dados">
            <img class="img_usuario" src="./assets/img/masterIcon.png" alt="">
            <div class="container_dados_fundo">
                <div class="container_info_usuario">
                    <div class="container_info_time">
                        <div 
                        id="img"></div>
                        <h4 id="sigla"></h4>
                    </div>
                    <h4 id="nome" style="margin-top: 10px; width: 200px; text-align: center;"></h4>
                    <div class="container_info_moeda">
                        <img src="./assets/img/Desenho-Moedas-Dinheiro-Bitcoin-PNG.png" alt="">
                        <span id="moeda">0</span>
                    </div>
                </div>
                <div class="container_banner">
                    <div class="banner_dados">
                        <div class="text_conteudo">

                            <h4>Quem vai ganhar?</h4>
                            <p>Lorem Ipsum é simplesmente uma simulação de texto da
                                indústria tipográfica e de impressos, e vem sendo utilizado
                                desde o século XVI</p>
                        </div>
                            <div class="proximos_jogos_home">
                                <div class="proximos_jogos_home_time">
    
                                    <h3>ITZ</h3>
                                    <div class="dados_votos">
                                        <span id="time1" class="placar_votos">0</span>
                                        <img src="./assets/img/INTZ_Logo.png" alt="INTZ">
                                    </div>
                                    <h4>VS</h4>
                                    <div class="dados_votos">
                                        <span id="time2" class="placar_votos">0</span>
                                        <img src="./assets/img/flamengo-esports-logo.webp" alt="Flamengo">
                                    </div>
                                    <h3 style="justify-content:flex-end ;">FLA</h3>
                                </div>
                                <div class="proximos_jogos_home_quando">
                                    <p>CBLOL</p>
                                    <p style="justify-content: center;">17:30</p>
                                    <p style="justify-content:flex-end;">28/11/22</p>
                                </div>
                            </div>
                            <button onclick="votar_em_um_time()" class="button_votar">VOTE</button>
                    </div>
                    <div class="banner_dados">
                        <div class="text_conteudo">

                            <h4>Qual a maior torcida?</h4>
                            <p>Lorem Ipsum é simplesmente uma simulação de texto da
                                indústria tipográfica e de impressos, e vem sendo utilizado
                                desde o século XVI</p>
                        </div>
                        <img style="width: 12vw;" src="./assets/img/graficos.png" alt="">
                        <button onclick="" class="button_votar">GRÁFICOS</button>
                    </div>
                    <div class="banner_dados">
                        <div class="text_conteudo">

                            <h4>Você sabe a Reposta?</h4>
                            <p>Lorem Ipsum é simplesmente uma simulação de texto da
                                indústria tipográfica e de impressos, e vem sendo utilizado
                                desde o século XVI</p>
                        </div>
                        <img style="height: 14vh;" src="./assets/img/quest.png" alt="">
                        <button onclick="" class="button_votar">QUESTION</button>
                    </div>
                </div>
                
            </div>
        </div>
    </main>
</body>

</html>

<script>

    nome.innerHTML = sessionStorage.NOME_USUARIO;
    moeda.innerHTML = sessionStorage.MOEDA;
    sigla.innerHTML = sessionStorage.SIGLA_TIME;
    img.innerHTML = `<img src="${sessionStorage.IMG_LOGO}" alt="">`;
    var idPartida = 1;

    function atualizarVoto(){
        fetch(`/usuarios/listarVotos`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        time2.innerHTML = JSON.stringify(resposta[0].b);
                        time1.innerHTML = JSON.stringify(resposta[0].a);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });

    }

    function cadastrarVoto1() {
        aguardar();
        
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var idUsuarioVar = sessionStorage.ID_USUARIO;
        var votoTime1Var = 1;
        var votoTime2Var = 0;

        if (idUsuarioVar == "" || votoTime1Var == "" || votoTime2Var == "") {
            alert("Erro preencha todos os campos em branco");
            finalizarAguardar();
            return false;

        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarVoto", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idUsuarioServer: idUsuarioVar,
                votoTime1Server: votoTime1Var,
                votoTime2Server: votoTime2Var
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                setTimeout(() => {
                    window.location = "./dados.html";
                }, "1000")
                
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function cadastrarVoto2() {
        aguardar();
        
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var idUsuarioVar = sessionStorage.ID_USUARIO;
        var votoTime1Var = 0;
        var votoTime2Var = 1;

        if (idUsuarioVar == "" || votoTime1Var == "" || votoTime2Var == "") {
            alert("Erro preencha todos os campos em branco");
            finalizarAguardar();
            return false;

        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarVoto", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idUsuarioServer: idUsuarioVar,
                votoTime1Server: votoTime1Var,
                votoTime2Server: votoTime2Var
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                setTimeout(() => {
                    window.location = "./dados.html";
                }, "1000")
                
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none"
    }

</script>

