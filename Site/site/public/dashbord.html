<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPlayers | Dados</title>
    <link rel="stylesheet" href="./css/componentes.css">
    <link rel="stylesheet" href="./css/dados.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="times(), ltUser()">
    <header>
        <div class="container_header">
            <div class="container">
                <div class="container_img_logo">
                    <img style="cursor:default;" src="./assets/icon/logoHome.png" alt="Logo">
                </div>
                <img class="img_sair" src="./assets/img/logof.png" onclick="window.location.href='./index.html'"></img>
            </div>
    </header>

    <main>
        <div class="container_dados">
            <img class="img_usuario" src="./assets/img/masterIcon.png" alt="">
            <div class="container_dados_fundo">
                <div class="container_info_usuario">
                    <div class="container_info_time">
                        <img style="cursor: pointer;" onclick="window.location.href='./dados.html'" src="./assets/img/voltar_branco.png">
                        <div id="img"></div>
                        <h4 id="sigla"></h4>
                    </div>
                    <h4 id="nome" style="margin-top: 10px; width: 200px; text-align: center;"></h4>
                    <div class="container_info_moeda">
                        <img src="./assets/img/Desenho-Moedas-Dinheiro-Bitcoin-PNG.png" alt="">
                        <span id="moeda">0</span>
                    </div>
                </div>
                <div class="container_banner">
                    <canvas class="graficos" id="graficoTimes"></canvas>
                </div>
            </div>
        </div>
    </main>
</body>



</html>

<script>

    nome.innerHTML = sessionStorage.NOME_USUARIO;
    sigla.innerHTML = sessionStorage.SIGLA_TIME;
    img.innerHTML = `<img src="./assets/img/${sessionStorage.IMG_LOGO}" alt="${sessionStorage.SIGLA_TIME}">`;
    var idPartida = 1;
    var idUsuario = sessionStorage.ID_USUARIO;
    var pergunta = 0;
    var voto = 0;


    function ltUser() {
        fetch(`/usuarios/listarUsuario/${idUsuario}`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        var pg = JSON.stringify(resposta[0].pergunta);
                        var vt = JSON.stringify(resposta[0].voto);
                        var md = JSON.stringify(resposta[0].moeda);
                        moeda.innerHTML = md.replace(/"/g, "");
                        pergunta = pg.replace(/"/g, "");
                        voto = vt.replace(/"/g, "");

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });

    }
    sigla.innerHTML = sessionStorage.SIGLA_TIME;
    img.innerHTML = `<img src="./assets/img/${sessionStorage.IMG_LOGO}" alt="${sessionStorage.SIGLA_TIME}">`;
    var idUsuario = sessionStorage.ID_USUARIO;
    var t1 = '';
    var t2 = '';
    var t3 = '';
    var t4 = '';
    var t5 = '';
    var t6 = '';
    var t7 = '';
    var t8 = '';
    var t9 = '';
    var t10 = '';
    var q1 = '';
    var q2 = '';
    var q3 = '';
    var q4 = '';
    var q5 = '';
    var q6 = '';
    var q7 = '';
    var q8 = '';
    var q9 = '';
    var q10 = '';

    function qTimes(){
        fetch(`/usuarios/qtdTime`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        q1 = JSON.stringify(resposta[0].smT);
                        q2 = JSON.stringify(resposta[1].smT)
                        q3 = JSON.stringify(resposta[2].smT)
                        q4 = JSON.stringify(resposta[3].smT)
                        q5 = JSON.stringify(resposta[4].smT)
                        q6 = JSON.stringify(resposta[5].smT)
                        q7 = JSON.stringify(resposta[6].smT)
                        q8 = JSON.stringify(resposta[7].smT)
                        q9 = JSON.stringify(resposta[8].smT)
                        q10 = JSON.stringify(resposta[9].smT)
                        grafico()
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });
    }

    function times() {
        fetch(`/usuarios/listarTimes`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        t1 = JSON.stringify(resposta[0].nomeTime);
                        t2 = JSON.stringify(resposta[1].nomeTime)
                        t3 = JSON.stringify(resposta[2].nomeTime)
                        t4 = JSON.stringify(resposta[3].nomeTime)
                        t5 = JSON.stringify(resposta[4].nomeTime)
                        t6 = JSON.stringify(resposta[5].nomeTime)
                        t7 = JSON.stringify(resposta[6].nomeTime)
                        t8 = JSON.stringify(resposta[7].nomeTime)
                        t9 = JSON.stringify(resposta[8].nomeTime)
                        t10 = JSON.stringify(resposta[9].nomeTime)
                        qTimes();
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });

    }


    function grafico(){
        var time1 = t1.replace(/"/g, "");
        var time2 = t2.replace(/"/g, "");
        var time3 = t3.replace(/"/g, "");
        var time4 = t4.replace(/"/g, "");
        var time5 = t5.replace(/"/g, "");
        var time6 = t6.replace(/"/g, "");
        var time7 = t7.replace(/"/g, "");
        var time8 = t8.replace(/"/g, "");
        var time9 = t9.replace(/"/g, "");
        var time10 = t10.replace(/"/g, "");
        var qtdtime1 = q1.replace(/"/g, "");
        var qtdtime2 = q2.replace(/"/g, "");
        var qtdtime3 = q3.replace(/"/g, "");
        var qtdtime4 = q4.replace(/"/g, "");
        var qtdtime5 = q5.replace(/"/g, "");
        var qtdtime6 = q6.replace(/"/g, "");
        var qtdtime7 = q7.replace(/"/g, "");
        var qtdtime8 = q8.replace(/"/g, "");
        var qtdtime9 = q9.replace(/"/g, "");
        var qtdtime10 = q10.replace(/"/g, "");

        const labels = [
            `${time1}`,
            `${time2}`,
            `${time3}`,
            `${time4}`,
            `${time5}`,
            `${time6}`,
            `${time7}`,
            `${time8}`,
            `${time9}`,
            `${time10}`,
        ];

        const data = {
            labels: labels,
            datasets: [{
                label: 'Quatidade de Torcedores',
                backgroundColor: 'rgb(123, 23, 125)',
                borderColor: '#FFF',
                data: [qtdtime1, qtdtime2, qtdtime3, qtdtime4, qtdtime5, qtdtime6, qtdtime7, qtdtime8, qtdtime9, qtdtime10],
            }]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {}
        };
        const bar = new Chart(
            document.getElementById('graficoTimes'),
            config
        );
    }
</script>